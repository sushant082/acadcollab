<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  </head>
  <body>
    <%- include('../partials/header') %>

    <h1>Create a New Group</h1>
    <% if (typeof error !== "undefined") { %>
      <div id="groupError">
        <%= error %>
      </div>
    <% } %>
    <form action="/groups" method="POST">
      <input type="text" name="groupName" placeholder="Enter group name" required>
      <button type="submit">Create Group</button>
    </form>

    <h2>Existing Groups</h2>
    <ul>
        <% groups.forEach(function(group) { %>
          <li>
            <strong><%= group.name %></strong>
      
            <% if (user && user.username === group.owner) { %>
              (owned by you)
      
              <!-- Add Member Dropdown -->
              <form method="POST" action="/groups/<%= group._id %>/add-member" style="display:inline;">
                <select name="memberUsername" required>
                  <% users.forEach(function(u) { 
                      if (!group.members.includes(u.username)) { %>
                        <option value="<%= u.username %>"><%= u.username %></option>
                  <% } }); %>
                </select>
                <button type="submit">Add</button>
              </form>
      
              <!-- Remove Members -->
              <ul>
                <% group.members.forEach(function(member) { %>
                  <li>
                    <%= member %>
                    <% if (member !== group.owner) { %>
                      <form method="POST" action="/groups/<%= group._id %>/remove-member" style="display:inline;">
                        <input type="hidden" name="memberUsername" value="<%= member %>">
                        <button type="submit">Remove</button>
                      </form>
                    <% } %>
                  </li>
                <% }); %>
              </ul>
      
              <!-- Delete Group -->
              <form method="POST" action="/groups/<%= group._id %>/delete">
                <input type="password" name="password" placeholder="Confirm password to delete" required>
                <button type="submit">Delete Group</button>
              </form>
      
            <% } else { %>
              (owner: <%= group.owner %>)
              <br>Members: <%= group.members.join(", ") %>
            <% } %>
          </li>
        <% }); %>
      </ul>
      
  </body>
</html>
